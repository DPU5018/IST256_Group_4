<!DOCTYPE html>
<!-- Team Contributions: AJAX implementation by Hamlet Baghdasaryan -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shipping</title>
    <link rel="stylesheet" type="text/css" href = "Css.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Library Include (per assignment): AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
</head>
<body ng-app="shippingApp">
<header>
    <nav>
        <ul>
            <li><a href="index.html">Sign Up</a></li>
            <li><a href="ShoppingCart.html">Cart</a></li>
            <li><a href="ProductManagement.html">Product Management</a></li>
            <li><a href="Shipping.html"> Shipping Information</a></li>
            <li><a href="BillingDetails.html">Billing Details</a></li>
        </ul>
    </nav>
    <hr>
    <h1>TBD Proto Corp inc LLC</h1>
</header>
<section>
    <div ng-controller="ShipCtrl as vm">
    <h2> Shipping Carrier Information</h2>
    <div>
        <div>
            <label for="address">Address:</label><br>
            <input type="text" id="address" name="address" ng-model="vm.shipping.address"><br>

        </div>
        <div>
            <label for="city">City:</label><br>
            <input type="text" id="city" name="city" ng-model="vm.shipping.city"><br>
        </div>
        <div>
            <label for="state">State:</label><br>
            <input type="text" id="state" name="state" ng-model="vm.shipping.state"><br>
        </div>
        <div>
            <label for="ZIP">ZIP Code:</label><br>
            <input type="text" id="ZIP" name="ZIP" ng-model="vm.shipping.zip"><br>
        </div>
        <div>
            <label for="carrier">Select a Carrier:</label><br>
            <select name="carrier" id="carrier" ng-model="vm.shipping.carrier">
                <option value=" " selected="selected">Select Carrier</option>
                <option value="USPS">USPS</option>
                <option value="FEDEX">FEDEX</option>
                <option value="UPS">UPS</option>
            </select>
            <br>
        </div>
        <div>
            <label for="method">Select a method:</label><br>
            <select name="method" id="method" ng-model="vm.shipping.method">
                <option value=" " selected="selected">Select method</option>
                <option value="Expedited">Expedited</option>
                <option value="Standard">Standard</option>
                <option value="Free">Free</option>
            </select>
            <br>
            <br>
        </div>
        <input type="submit" id="Ship" value="Submit">
        <br>
        <pre id="jsonOutput" class="bg-light p-3 border rounded"></pre>
        <h5 class="mt-3">AngularJS JSON (live)</h5>
        <pre id="ngJson" class="bg-light p-3 border rounded">{{ vm.shipping | json:2 }}</pre>
        <div id="ajaxStatus" class="mt-3"></div>
        <pre id="ajaxResponse" class="bg-light p-3 border rounded"></pre>
    </div>
    </div>
</section>
<script>
    $(document).ready(function() {
        $("#Ship").click(function(event) {
            event.preventDefault(); // Stop page reload

            // Gather form values
            let address = $("#address").val().trim();
            let city = $("#city").val().trim();
            let state = $("#state").val().trim();
            let zip = $("#ZIP").val().trim();
            let carrier = $("#carrier").val().trim();
            let method = $("#method").val().trim();
            // AJAX endpoint (to be implemented in NodeJS later)
            // Author (AJAX): Hamlet Baghdasaryan
            const API_ENDPOINT = "/api/shipping";

            // Basic validation
            if (!address || !city || !state || !zip || carrier === " " || method === " ") {
                alert("Please complete all fields before submitting.");
                return;
            }

            // Create JSON object
            let shippingInfo = {
                Address: address,
                City: city,
                State: state,
                ZIP: zip,
                Carrier: carrier,
                Method: method
            };

            // Display JSON formatted on page
            $("#jsonOutput").text(JSON.stringify(shippingInfo, null, 4));

            // --- AJAX transport to RESTful service (NodeJS API will be developed later) ---
            $("#ajaxStatus").removeClass().addClass("alert alert-info").text("Submitting shipping info...");
            $("#ajaxResponse").text("");
            $.ajax({
                url: API_ENDPOINT,
                method: "POST",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(shippingInfo),
                success: function(resp) {
                    $("#ajaxStatus").removeClass().addClass("alert alert-success").text("Shipping info submitted successfully.");
                    // Pretty print any JSON response from the server (echo, id, etc.)
                    try {
                        $("#ajaxResponse").text(JSON.stringify(resp, null, 4));
                    } catch (e) {
                        $("#ajaxResponse").text(String(resp));
                    }
                },
                error: function(jqXHR) {
                    const msg = jqXHR.responseText || "Request failed. Ensure the NodeJS API is running and CORS is configured.";
                    $("#ajaxStatus").removeClass().addClass("alert alert-danger").text(msg);
                    if (jqXHR.responseJSON) {
                        $("#ajaxResponse").text(JSON.stringify(jqXHR.responseJSON, null, 4));
                    }
                }
            });
        });
    });
</script>

<script>
(function(){
  angular.module('shippingApp', [])
    .controller('ShipCtrl', function(){
      var vm = this;
      vm.shipping = { address:'', city:'', state:'', zip:'', carrier:'', method:'' };
    });
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

